{{- if .Values.edge_config }}


apiVersion: v1
kind: Pod
metadata:
  name: "{{ .Release.Name }}-connection-test"
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
  - name: {{ .Release.Name }}-connections-test
    image: "centos"
{{- if and .Values.edge_config ( eq .Values.edge_config.remove_namespace_from_url "true" ) }}
    command: ["sh", "-c", "ls /etc/test/certs/ && curl --location --cert /etc/test/certs/server.crt --key /etc/test/certs/server.key --request GET \"https://{{ .Values.edge_config.route_url_name }}.{{ .Values.edge_config.domain }}/{{ .Values.documentation.base_path }}\" -vk"]
{{- else }}
    command: ["sh", "-c", "ls /etc/test/certs/ && curl --location --cert /etc/test/certs/server.crt --key /etc/test/certs/server.key --request GET \"https://{{ .Values.edge_config.route_url_name }}.{{ .Release.Namespace }}.{{ .Values.edge_config.domain }}/{{ .Values.documentation.base_path }}\" -vk"]
{{- end }}
    volumeMounts:
      - name: test-certs
        mountPath: /etc/test/certs/
  restartPolicy: Never
  volumes:
    - name: test-certs
      secret:
        secretName: sidecar


{{- end }}
