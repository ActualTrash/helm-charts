<form theme="dark">
  <label>Active Users, Bandwidth, and Forecasting</label>
  <fieldset submitButton="false"></fieldset>
  <row>
    <panel>
      <title>Active Users by Time</title>
      <viz type="Splunk_ML_Toolkit.LinesViz">
        <search>
          <query>host="decipher-demo-canned"  | bin _time span=1d | stats dc(payload.request.headers.user_dn) as active_users by _time</query>
          <earliest>0</earliest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="height">167</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
    <panel>
      <single>
        <title>Change in Active Users by 12 Hours</title>
        <search>
          <query>host=decipher-demo-canned | bin _time span=12h | timechart dc(payload.request.headers.user_dn)</query>
        </search>
        <option name="colorBy">trend</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="showSparkline">0</option>
        <option name="trellis.size">large</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendInterval">-12h</option>
        <option name="underLabel">Compared to 12 hours before</option>
        <option name="useColors">1</option>
      </single>
      <single>
        <title>Change in Active Users by Hour</title>
        <search>
          <query>host=decipher-demo-canned | bin _time span=1h | timechart dc(payload.request.headers.user_dn)</query>
        </search>
        <option name="colorBy">trend</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="showSparkline">0</option>
        <option name="trellis.size">large</option>
        <option name="trendInterval">-1h</option>
        <option name="underLabel">Compared to 1 hour before</option>
        <option name="useColors">1</option>
      </single>
      <single>
        <title>Change in Active Users by Day</title>
        <search>
          <query>host=decipher-demo-canned | bin _time span=1d | timechart dc(payload.request.headers.user_dn)</query>
        </search>
        <option name="colorBy">trend</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="showSparkline">0</option>
        <option name="trellis.size">large</option>
        <option name="trendInterval">-1d</option>
        <option name="underLabel">Compared to 1 day before</option>
        <option name="useColors">1</option>
      </single>
      <single>
        <title>Change in Active Users by Week</title>
        <search>
          <query>host=decipher-demo-canned | bin _time span=1w | timechart dc(payload.request.headers.user_dn)</query>
        </search>
        <option name="colorBy">trend</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="showSparkline">0</option>
        <option name="trellis.size">large</option>
        <option name="trendInterval">-1w</option>
        <option name="underLabel">Compared to 1 week before</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>MB/hour over time</title>
      <viz type="Splunk_ML_Toolkit.LinesViz">
        <search>
          <query>host="decipher-demo-canned" | eval eventSize = len("payload.response.headers.content-length")/1024/1024 | timechart span=1h sum(eventSize) as "MB/hour"</query>
          <earliest>0</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="height">201</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
    <panel>
      <single>
        <title>Average MB/hour</title>
        <search>
          <query>host="decipher-demo-canned"  | eval eventSize = len("payload.response.headers.content-length")/1024/1024 | timechart span=1h sum(eventSize) as "MB/hour" | stats sum("MB/hour") as summb count("MB/hour") as cmb | eval average_bandwidth=summb/cmb | table average_bandwidth</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="numberPrecision">0.000</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Megabytes/hour</option>
        <option name="useColors">0</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Prediction of Active Users in 30 days</title>
      <input type="text" token="input_CI2">
        <label>Confidence Interval (0-99)</label>
        <default>0</default>
        <change>
          <eval token="CI2">if(match(value, "^[0-9]+$"), $value$, "0")</eval>
        </change>
      </input>
      <viz type="Splunk_ML_Toolkit.ForecastViz">
        <search>
          <query>host=decipher-demo-canned
          | timechart span=1d dc(payload.request.headers.user_dn) as active_users
          | predict "active_users" as prediction algorithm=LLP holdback=0 future_timespan=30 period=7 upper$CI2$=upper$CI2$ lower$CI2$=lower$CI2$ 
          | `forecastviz(30, 0, "active_users", $CI2$)`</query>
          <earliest>0</earliest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="height">342</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
    <panel>
      <title>Prediction of Bandwidth in 30 days</title>
      <input type="text" token="input_CI3">
        <label>Confidence Interval (0-99)</label>
        <default>0</default>
        <change>
          <eval token="CI3">if(match(value, "^[0-9]+$"), $value$, "0")</eval>
        </change>
      </input>
      <viz type="Splunk_ML_Toolkit.ForecastViz">
        <search>
          <query>host=decipher-demo-canned
          | timechart span=1d sum(payload.response.body) as "MB/minute"
          | predict "MB/minute" as prediction algorithm=LLP holdback=0 future_timespan=30 period=7 upper$CI3$=upper$CI3$ lower$CI3$=lower$CI3$ 
          | `forecastviz(30, 0, "MB/minute", 0)`</query>
          <earliest>0</earliest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="height">345</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
</form>