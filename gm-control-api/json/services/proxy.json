{
  "proxy_key": "proxy-{{.service.serviceName}}",
  "zone_key": "{{.service.zone}}",
  "name": "{{.service.serviceName}}",
  "domain_keys": [
    "domain-{{.service.serviceName}}"{{- if .Values.global.spire.enabled }},
    "domain-{{.service.serviceName}}-local"
    {{- end }}
  ],
  "listener_keys": [
      "listener-{{.service.serviceName}}"{{- if .Values.global.spire.enabled }},
      "listener-{{.service.serviceName}}-local"
      {{- end }}
  ],
  "listeners": null,
  "active_proxy_filters": [
  {{- if (.service.observablesEnabled) }}
    "gm.observables",
  {{- end }}
  {{- if not (.Values.global.spire.enabled) }}
    "gm.impersonation",
  {{- end }}
    "gm.metrics"
  ],
  "proxy_filters": {
    {{-  if (.service.observablesEnabled) }}
    "gm_observables": {
      "useKafka": true,
      "topic": "{{.service.serviceName}}",
      "eventTopic": "{{ .Values.global.observables.topic }}",
      "kafkaServerConnection": "{{ .Values.global.observables.kafkaServerConnection }}"
    },
    {{- end }}
    {{- if and (not .Values.global.spire.enabled) (.Values.global.mesh_tls.enabled) }}
    "gm_impersonation": {
      "servers": "{{ .Values.global.edge.egressDn }}{{- if not (eq .service.serviceName "dashboard") -}}|{{ .Values.global.mesh_tls.dn }}{{- end -}}"
    },
    {{- end }}
    "gm_metrics": {
      "metrics_port": 8081,
      "metrics_host": "0.0.0.0",
      "metrics_dashboard_uri_path": "/metrics",
      "metrics_prometheus_uri_path": "/prometheus",
      "prometheus_system_metrics_interval_seconds": 15,
      "metrics_ring_buffer_size": 4096,
      "metrics_key_function": "depth",
      "metrics_key_depth": "1"
    }
  }
}
